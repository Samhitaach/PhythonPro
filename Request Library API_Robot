*** Settings ***
Library    RequestsLibrary
Library    Collections
Suite Setup    Authenticate as Admin

*** Test Cases ***
Get Bookings from Restful Booker
 ${body} Create Dictionary firstname="hita"
 ${response} GET  https://restful-booker.herokuapp.com/booking    ${body}
 status should be 200
 log List  ${response.json()}
 FOR  ${booking} IN @{response.json()}
   ${response} GET  https://restful-booker.herokuapp.com/booking/${booking}[bookingid]    ${body}
   TRY
    Log  ${response.json()}
   EXCEPT
    Log cannot retrive JSON due to invalid data
   END
 END

Create a Booking at Restful Booker
 ${booking_dates}    Create Dictionary    checkin=2022-12-31    checkout=2023-01-01
    ${body}    Create Dictionary    firstname=Hans    lastname=Gruber    totalprice=200    depositpaid=false    bookingdates=${booking_dates}
    ${response}    POST    url=https://restful-booker.herokuapp.com/booking    json=${body}
    ${id}    Set Variable    ${response.json()}[bookingid]
    Set Suite Variable    ${id}
    ${response}    GET    https://restful-booker.herokuapp.com/booking/${id}
    Log    ${response.json()}
    Should Be Equal    ${response.json()}[lastname]    Gruber
    Should Be Equal    ${response.json()}[firstname]    Hans   
    Should Be Equal As Numbers    ${response.json()}[totalprice]    200
    Dictionary Should Contain Value     ${response.json()}    Gruber
 
Basic Authentication and OAuth2
*** Keywords ***
Authenticate as Admin
    ${body}    Create Dictionary    username=admin    password=password123
    ${response}    POST    url=https://restful-booker.herokuapp.com/auth    json=${body}
    Log    ${response.json()}
    ${token}    Set Variable    ${response.json()}[token]
    Log    ${token}
    Set Suite Variable    ${token}

*** Settings ***
Library           RequestsLibrary
Library           Collections
Library           BuiltIn

*** Variables ***
${BASE_URL}       https://httpbin.org/basic-auth/user/pass
${USERNAME}       user
${PASSWORD}       pass

*** Keywords ***
Create Basic Auth Header
    ${credentials}=    Set Variable    ${USERNAME}:${PASSWORD}
    ${encoded}=    Evaluate    str(base64.b64encode('${credentials}'.encode('utf-8')), 'utf-8')    modules=base64
    ${headers}=    Create Dictionary    Content-Type=application/json
    Set To Dictionary    ${headers}    Authorization=Basic ${encoded}
    [Return]    ${headers}

*** Test Cases ***
Test Basic Auth with Custom Header
This will belp to debug as well 
    ${headers}=    Create Basic Auth Header
    Create Session    api_session    ${BASE_URL}    headers=${headers}
    ${response}=    GET On Session    api_session    ${BASE_URL}
    Log To Console    Status Code: ${response.status_code}
    Log To Console    Response Body: ${response.text}
    Should Be Equal As Numbers    ${response.status_code}    200

*** Settings ***
Library    RequestsLibrary

*** Variables ***
${BASE_URL}        https://your-api-base-url.com
${TOKEN_URL}       https://your-api-base-url.com/oauth/token
${CLIENT_ID}       your_client_id
${CLIENT_SECRET}   your_client_secret

*** Test Cases ***
OAuth2 Authentication with Client Credentials
    # Prepare token request data and headers
    ${data}=    Create Dictionary    grant_type=client_credentials    client_id=${CLIENT_ID}    client_secret=${CLIENT_SECRET}
    ${headers}=    Create Dictionary    Content-Type=application/x-www-form-urlencoded

    # Request access token
    Create Session    oauth    ${BASE_URL}
    ${resp}=    Post Request    oauth    ${TOKEN_URL}    data=${data}    headers=${headers}
    Should Be Equal As Strings    ${resp.status_code}    200

    # Extract token and prepare auth header
    ${access_token}=    Evaluate    ${resp.json()["access_token"]}
    ${auth_header}=    Create Dictionary    Authorization=Bearer ${access_token}

    # Make an authenticated API call using the token
    ${resp2}=    Get Request    oauth    /some/protected/endpoint    headers=${auth_header}
    Should Be Equal As Strings    ${resp2.status_code}    200
    Log    ${resp2.text}


